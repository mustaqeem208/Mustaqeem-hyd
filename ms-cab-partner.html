<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MS Partner</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

<style>
body { margin:0; background:#000; color:white; font-family:Arial; }
#dLoginScreen { position:fixed; inset:0; background:#000; display:flex; flex-direction:column; justify-content:center; align-items:center; }
.d-inp { width:80%; padding:12px; background:#111; border:1px solid #333; color:white; text-align:center; margin-bottom:10px; }
.d-btn { width:83%; padding:12px; background:#d4af37; border:none; font-weight:bold; }
#dApp { display:none; height:100vh; }
#map { height:100vh; width:100%; }

.card { position:absolute; left:10px; right:10px; bottom:20px; padding:15px; background:#111; border-radius:12px; border:1px solid #333; display:none; }

.contact-btn { background:#1e90ff; padding:10px; border:none; color:white; width:100%; border-radius:8px; margin-bottom:10px; }
.green-btn { background:#4caf50; }

.otp-row { display:flex; gap:10px; }
.otp-inp { flex:1; background:#000; border:1px solid #d4af37; color:white; padding:10px; text-align:center; }
.go-btn { padding:0 15px; background:#d4af37; border:none; }

</style>
</head>

<body>

<div id="dLoginScreen">
    <h2 style="color:#d4af37;">MS PARTNER</h2>
    <input id="dPhone" class="d-inp" type="tel" placeholder="Enter Mobile Number">
    <button class="d-btn" onclick="startDuty()">START DUTY</button>
</div>

<div id="dApp">
    <div id="map"></div>

    <!-- RIDE REQUEST POPUP -->
    <div id="reqPopup" class="card">
        <h3>NEW RIDE REQUEST</h3>
        <div>Fare: ‚Çπ<span id="fareDisplay">0</span></div>
        <button onclick="tryAcceptRide()" class="contact-btn">ACCEPT</button>
        <button onclick="skipRide()" class="contact-btn" style="background:#444;">SKIP</button>
    </div>

    <!-- PICKUP CARD -->
    <div id="pickupCard" class="card">
        <h3>PICKUP</h3>
        <div id="custMobDisp"></div>
        <button id="mapToPickupBtn" class="contact-btn">üó∫Ô∏è MAP ‚Äî Pickup par jao</button>

        <div class="otp-row">
            <input id="otpIn" class="otp-inp" type="number" placeholder="OTP">
            <button class="go-btn" onclick="verifyOtp()">START</button>
        </div>

        <button onclick="cancelRide()" class="contact-btn" style="background:red;">CANCEL RIDE</button>
    </div>

    <!-- DROP CARD -->
    <div id="dropCard" class="card">
        <h3>ON TRIP</h3>
        <button id="mapToDropBtn" class="contact-btn green-btn">üó∫Ô∏è MAP ‚Äî Drop par jao</button>
        <button onclick="completeRide()" class="contact-btn" style="background:#000; border:1px solid #d4af37;">END TRIP</button>
    </div>

</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="
  
  let map, driverMarker, driverLat=17.3850, driverLng=78.4867;
let currentReqData = null;

function startDuty() {
    document.getElementById("dLoginScreen").style.display = "none";
    document.getElementById("dApp").style.display = "block";
    initMap();
    simulateRequest(); // TEST REQUEST
}

function initMap() {
    map = L.map('map').setView([driverLat, driverLng], 14);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png')
      .addTo(map);

    driverMarker = L.marker([driverLat, driverLng]).addTo(map);
}

function simulateRequest() {
    currentReqData = {
        pickupLat: 17.4370,
        pickupLng: 78.3950,
        dropLat: 17.4455,
        dropLng: 78.4020,
        customerMobile: "9000000000",
        otp: 1234,
        price: 150
    };

    document.getElementById("reqPopup").style.display = "block";
    document.getElementById("fareDisplay").textContent = currentReqData.price;
}

function tryAcceptRide() {
    document.getElementById("reqPopup").style.display = "none";
    document.getElementById("pickupCard").style.display = "block";

    document.getElementById("custMobDisp").textContent = currentReqData.customerMobile;
}

function skipRide() {
    document.getElementById("reqPopup").style.display = "none";
}

function openNavigation(lat, lng) {
    const url = `https://www.google.com/maps/dir/?api=1&destination=${lat},${lng}`;
    window.open(url, "_blank");
}

document.getElementById("mapToPickupBtn").onclick = () => {
    openNavigation(currentReqData.pickupLat, currentReqData.pickupLng);
};

document.getElementById("mapToDropBtn").onclick = () => {
    openNavigation(currentReqData.dropLat, currentReqData.dropLng);
};

function verifyOtp() {
    let otp = document.getElementById("otpIn").value;

    if (otp == currentReqData.otp) {
        document.getElementById("pickupCard").style.display = "none";
        document.getElementById("dropCard").style.display = "block";
    } else {
        alert("Wrong OTP");
    }
}

function cancelRide() {
    location.reload();
}

function completeRide() {
    alert("Trip Completed");
    location.reload();
}"></script>

</body>
</html>
